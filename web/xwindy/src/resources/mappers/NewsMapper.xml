<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xwindy.web.mapper.NewsMapper">
	<resultMap type="News" id="NewsResult">
		<id property="id" column="id" />
		<result property="publicId" column="public_id" />
		<result property="publicName" column="public_name" />
		<result property="publicIP" column="public_ip" />
		<result property="title" column="title" />
		<result property="content" column="content" />
		<result property="url" column="url_from" />
		<result property="datetime" column="datetime" />
		<result property="push" column="push" />
		<result property="clickNum" column="click" />
		<result property="commentNum" column="comment_number" />
	</resultMap>
	<select id="getNewsListByPage"
			resultMap="NewsResult">
			SELECT * FROM news
			ORDER BY id DESC
			<include refid="pageLimitSql" />
	</select>
	<select id="getNewsListByUserIdAndPage"
			resultMap="NewsResult">
			SELECT * FROM user_subscribe_news_view
			WHERE user_id = #{userId}
			ORDER BY id DESC
			<include refid="pageLimitSql" />
	</select>
	<select id="getNewsListByPublicIdAndPage"
			resultMap="NewsResult">
			SELECT * FROM news_and_public_view
			WHERE id = #{publicId}
			ORDER BY id DESC
			<include refid="pageLimitSql" />
	</select>
	<select id="getNewsById"
			parameterType="int"
			resultMap="NewsResult">
			SELECT * FROM news_and_public_view
			WHERE id = #{id}
	</select>
	<update id="addClickNumberById"
			parameterType="int">
			UPDATE news
			SET click = click + 1
			WHERE id = #{id} 
	</update>
	<insert id="addNews"
			parameterType="News">
			INSERT INTO news
				(public_id, public_ip, title, content, datetime, url_from, push)
			VALUES
				(#{publicId}, #{publicIP}, #{title}, #{content}, #{datetime}, #{url}, #{push})
	</insert>
	<update id="updateNews"
			parameterType="News">
			UPDATE news
			SET title = #{title}, content = #{content}, url_from = #{url}
			WHERE id = #{id}
	</update>
	<delete id="deleteNewsById"
			parameterType="int">
			DELETE FROM news
			WHERE id = #{id}
	</delete>
	
	<sql id="pageLimitSql">
		<if test="pageNo != null">
			LIMIT ${(pageNo * pageSize)}, ${pageSize}
		</if>
	</sql>
</mapper>